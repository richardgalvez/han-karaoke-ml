<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HearAndNow Karaoke Song Recommendation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <h1>HearAndNow Karaoke Song Recommendation System</h1>
    <a href="http://localhost:8888/notebooks/song-recommend-ml.ipynb" target="_blank">Check out the Jupyter Notebook for this project!</a>
    <h2>What would you like to sing?</h2>
    <form method="POST" action="/select_song">
        <table border="1">
            <tr>
                <th>Song Group</th>
                <th>HearAndNow Recommended Song</th>
            </tr>
            {% for cluster in clusters['clusters'].unique() %}
                {% set random_song_data = clusters[clusters['clusters'] == cluster].sample(n=1)[['track_name', 'artist_name']].values[0] %}
                <tr class="song-row" onclick="selectSong(this, '{{ random_song_data[0] }}');">
                    <td>{{ cluster }}</td>
                    <td>{{ random_song_data[0] }} by {{ random_song_data[1] }}</td>
                </tr>
            {% endfor %}
        </table>
        <input type="hidden" name="selected_song" id="selected_song_input" value="">
        <button type="submit" id="submit_button" disabled>Submit</button>
        <button type="button" class="refreshButton" onclick="window.location.href='/refresh'">Re-Roll Songs</button>
    </form>    
    <div id="history-and-percentages">
        <div class="history-section">
            <p>Previously Selected:</p>
            <div class="compact-list">
                {% for song, count in user_selections.items() %}
                    {% set artist = clusters[clusters['track_name'] == song]['artist_name'].iloc[0] %}
                    <div>{{ song }} by {{ artist }}</div>
                {% endfor %}
            </div>
        </div>
    
        <div class="percentages-section">
            <p>Song Group Selection Percentages:</p>
            <div class="compact-list">
                {% for cluster, percentage in cluster_percentages.items() %}
                    <div>Song Group {{ cluster }}: {{ "{:.2f}".format(percentage) }}%</div>
                {% endfor %}
            </div>
        </div>
    
    <script>
        function selectSong(row, songName) {
            var radioInput = document.getElementById('selected_song_input');
            var submitButton = document.getElementById('submit_button');
            radioInput.value = songName;
            submitButton.removeAttribute('disabled');
            row.style.backgroundColor = '#87CEEB';
            var otherRows = document.querySelectorAll('.song-row');
            for (var i = 0; i < otherRows.length; i++) {
                if (otherRows[i] !== row) {
                    otherRows[i].style.backgroundColor = '';
                }
            }
        }
    </script>
</body>
</html>
